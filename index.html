<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Waris Islam - Syariah Waris Indonesia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Font Latin -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Arab -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #e0e5ec;
            --text-main: #4a5568;
            --accent-color: #0d9488;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            -webkit-font-smoothing: antialiased;
            transition: all 0.3s ease;
            overflow: hidden; /* Prevent scrolling while locked */
        }

        /* Arabic Font Override */
        body.lang-ar {
            font-family: 'Tajawal', 'Amiri', sans-serif;
        }

        /* Neomorphism Utility Classes */
        .neu-flat {
            background: var(--bg-color);
            box-shadow: 9px 9px 16px var(--shadow-dark), 
                        -9px -9px 16px var(--shadow-light);
            border-radius: 20px;
            border: none;
        }

        .neu-pressed {
            background: var(--bg-color);
            box-shadow: inset 6px 6px 10px var(--shadow-dark), 
                        inset -6px -6px 10px var(--shadow-light);
            border-radius: 12px;
            border: none;
            transition: all 0.3s ease;
        }
        
        .neu-pressed:focus {
            outline: none;
            box-shadow: inset 3px 3px 5px var(--shadow-dark), 
                        inset -3px -3px 5px var(--shadow-light),
                        0 0 5px rgba(13, 148, 136, 0.3);
        }

        .neu-icon-box {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--bg-color);
            box-shadow: 5px 5px 10px var(--shadow-dark), 
                        -5px -5px 10px var(--shadow-light);
            color: var(--accent-color);
        }

        .neu-btn {
            background: var(--bg-color);
            box-shadow: 6px 6px 10px var(--shadow-dark), 
                        -6px -6px 10px var(--shadow-light);
            color: var(--accent-color);
            font-weight: 700;
            border-radius: 50px;
            padding: 12px 30px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.5px;
        }

        .neu-btn:hover {
            transform: translateY(-2px);
            box-shadow: 8px 8px 14px var(--shadow-dark), 
                        -8px -8px 14px var(--shadow-light);
            color: #0f766e;
        }

        .neu-btn:active {
            box-shadow: inset 4px 4px 8px var(--shadow-dark), 
                        inset -4px -4px 8px var(--shadow-light);
            transform: translateY(1px);
        }
        
        .neu-btn.active-lang {
            box-shadow: inset 4px 4px 8px var(--shadow-dark), 
                        inset -4px -4px 8px var(--shadow-light);
            color: #0f766e;
            background-color: #d1d9e6;
        }

        .neu-btn.primary { color: #0f766e; }
        .neu-btn.secondary { color: #64748b; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
            border: 3px solid var(--bg-color);
        }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Styling Inputs */
        input[type="number"], input[type="text"], input[type="password"], select {
            width: 100%;
            padding: 12px 16px;
            background: transparent;
            color: #334155;
            font-weight: 600;
        }
        
        input[type="checkbox"] {
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--bg-color);
            box-shadow: inset 3px 3px 5px var(--shadow-dark), 
                        inset -3px -3px 5px var(--shadow-light);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }
        
        input[type="checkbox"]:checked { background: var(--bg-color); }
        input[type="checkbox"]:checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--accent-color);
            font-weight: bold;
            font-size: 14px;
        }

        /* Modal & Lock Screen */
        .payment-modal-overlay, #lockScreen {
            background-color: rgba(224, 229, 236, 0.95); /* Opaque background for lock */
            backdrop-filter: blur(10px);
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .payment-modal-content {
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .payment-modal-overlay.active .payment-modal-content { transform: scale(1); }

        /* Tooltip */
        .tooltip { position: relative; cursor: pointer; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 240px;
            background-color: var(--bg-color);
            color: var(--text-main);
            text-align: center;
            border-radius: 10px;
            padding: 10px;
            position: absolute;
            z-index: 10;
            bottom: 140%;
            left: 50%;
            margin-left: -120px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            box-shadow: 5px 5px 10px var(--shadow-dark), 
                        -5px -5px 10px var(--shadow-light);
            border: 1px solid rgba(255,255,255,0.5);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* Result Cards */
        .result-card-neu { border-inline-start: 5px solid var(--accent-color); }
        .hijab-card-neu { border-inline-start: 5px solid #f59e0b; }

        /* RTL Specifics */
        [dir="rtl"] .mr-4 { margin-right: 0; margin-left: 1rem; }
        [dir="rtl"] .mr-3 { margin-right: 0; margin-left: 0.75rem; }
        [dir="rtl"] .mr-2 { margin-right: 0; margin-left: 0.5rem; }
        [dir="rtl"] .ml-1 { margin-left: 0; margin-right: 0.25rem; }
        [dir="rtl"] .ml-2 { margin-left: 0; margin-right: 0.5rem; }
        [dir="rtl"] .border-l-4 { border-left-width: 0; border-right-width: 4px; }
        
        /* Security */
        body { user-select: none; -webkit-user-select: none; }
        input, textarea { user-select: text; -webkit-user-select: text; }

        /* Lock Screen Animations */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        #mainApp {
            filter: blur(8px);
            pointer-events: none;
            transition: filter 0.5s ease;
        }
        body.unlocked #mainApp {
            filter: none;
            pointer-events: auto;
        }
        body.unlocked #lockScreen {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        body.unlocked {
            overflow: auto;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col" oncontextmenu="return false;">

    <!-- LOCK SCREEN OVERLAY -->
    <div id="lockScreen" class="fixed inset-0 z-[100] flex flex-col items-center justify-center px-4">
        <div class="neu-flat p-8 w-full max-w-md text-center relative">
            <div class="mb-6 flex justify-center">
                <div class="neu-icon-box w-16 h-16 text-3xl">
                    ðŸ”’
                </div>
            </div>
            <h2 class="text-2xl font-bold text-teal-700 mb-2">Akses Terbatas</h2>
            <p class="text-slate-500 text-sm mb-6">Masukkan sandi untuk mengakses Kalkulator Waris.</p>
            
            <div class="mb-6">
                <input type="password" id="passwordInput" placeholder="Masukkan Sandi..." class="neu-pressed text-center text-lg">
                <p id="passwordError" class="text-red-500 text-xs mt-2 hidden font-bold">Sandi salah, silakan coba lagi.</p>
            </div>
            
            <button id="unlockButton" class="neu-btn primary w-full py-3 text-lg">
                Buka Kunci
            </button>
            
            <p class="mt-6 text-xs text-slate-400">Syariah Waris Indonesia Security</p>
        </div>
    </div>

    <!-- MAIN APPLICATION (Wrapped) -->
    <div id="mainApp" class="flex flex-col min-h-screen">
        <!-- Header -->
        <div class="py-6">
            <div class="container mx-auto px-4 flex justify-between items-center">
                <div class="w-1/4"></div> <!-- Spacer -->
                
                <div class="flex space-x-2 rtl:space-x-reverse">
                    <button onclick="changeLanguage('id')" id="btn-id" class="neu-btn text-sm px-4 py-2 active-lang">ID</button>
                    <button onclick="changeLanguage('en')" id="btn-en" class="neu-btn text-sm px-4 py-2">EN</button>
                    <button onclick="changeLanguage('ar')" id="btn-ar" class="neu-btn text-sm px-4 py-2">Ø¹Ø±Ø¨ÙŠ</button>
                </div>
            </div>

            <header class="container mx-auto px-4 text-center mt-4">
                <div class="neu-flat inline-block p-6 mb-4 rounded-3xl">
                    <h1 id="appTitle" class="text-3xl md:text-5xl font-extrabold text-teal-700 tracking-tight">Kalkulator Waris Islami</h1>
                </div>
                <p id="appDesc" class="text-center text-md md:text-lg mt-4 text-slate-500 font-medium">Hitung pembagian harta warisan sesuai syariat Islam secara presisi.</p>
            </header>
        </div>

        <main class="container mx-auto p-4 md:p-8 flex-grow">
            <div class="neu-flat p-6 md:p-10 mb-10">
                <div id="inputSection">
                    
                    <!-- Harta Section -->
                    <div class="flex items-center mb-8">
                        <div class="neu-icon-box mr-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <h2 id="lbl_section1" class="text-2xl font-bold text-teal-700">Rincian Harta & Kewajiban</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                        <div>
                            <label for="deceasedName" id="lbl_deceasedName" class="block text-sm font-bold text-slate-600 mb-2 ml-1">Nama Almarhum/ah:</label>
                            <input type="text" id="deceasedName" placeholder="Contoh: Muhammad Ali" class="neu-pressed">
                        </div>
                        <div>
                            <label for="totalHartaPeninggalan" id="lbl_totalHarta" class="block text-sm font-bold text-slate-600 mb-2 ml-1">Total Harta (Rp):</label>
                            <input type="number" id="totalHartaPeninggalan" placeholder="0" class="neu-pressed">
                        </div>
                        <div>
                            <label for="hutang" id="lbl_hutang" class="block text-sm font-bold text-slate-600 mb-2 ml-1">Hutang (Rp):</label>
                            <input type="number" id="hutang" placeholder="0" class="neu-pressed" value="0">
                        </div>
                        <div>
                            <label for="biayaJenazah" id="lbl_biayaJenazah" class="block text-sm font-bold text-slate-600 mb-2 ml-1">Biaya Jenazah (Rp):</label>
                            <input type="number" id="biayaJenazah" placeholder="0" class="neu-pressed" value="0">
                        </div>
                        <div>
                            <label for="wasiat" class="block text-sm font-bold text-slate-600 mb-2 ml-1 flex items-center gap-2">
                                <span id="lbl_wasiat">Wasiat (Rp)</span>
                                <span class="tooltip">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-teal-500">
                                      <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span id="tooltip_wasiat" class="tooltiptext text-xs">Maksimal 1/3 dari harta bersih. Otomatis disesuaikan jika melebihi.</span>
                                </span>
                            </label>
                            <input type="number" id="wasiat" placeholder="0" class="neu-pressed" value="0">
                        </div>
                        <div>
                            <label for="deceasedGender" id="lbl_gender" class="block text-sm font-bold text-slate-600 mb-2 ml-1">Jenis Kelamin:</label>
                            <div class="relative">
                                <select id="deceasedGender" class="neu-pressed appearance-none cursor-pointer">
                                    <option value="male" id="opt_male">Laki-laki</option>
                                    <option value="female" id="opt_female">Perempuan</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500 rtl:left-0 rtl:right-auto">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ahli Waris Section -->
                    <div class="flex items-center mb-8 mt-12">
                        <div class="neu-icon-box mr-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                        </div>
                        <h2 id="lbl_section2" class="text-2xl font-bold text-teal-700">Informasi Ahli Waris</h2>
                    </div>
                    
                    <p id="lbl_heirHint" class="text-sm text-slate-500 mb-6 ml-2 italic">Masukkan jumlah ahli waris. Kosongkan atau isi 0 jika tidak ada.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <!-- Pasangan -->
                        <div class="neu-flat p-6">
                            <h3 id="head_spouse" class="text-lg font-bold text-teal-600 mb-4">Pasangan</h3>
                            <div class="space-y-4">
                                <div class="flex items-center">
                                    <input type="checkbox" id="hasHusband" class="mr-3">
                                    <label for="hasHusband" id="lbl_husband" class="text-slate-700 font-medium">Suami <span class="text-xs text-slate-500 block">(jika almarhumah perempuan)</span></label>
                                </div>
                                <div>
                                    <label for="numWives" id="lbl_wives" class="block text-sm font-bold text-slate-600 mb-1">Jumlah Istri:</label>
                                    <input type="number" id="numWives" min="0" max="4" placeholder="0" class="neu-pressed" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- Anak -->
                        <div class="neu-flat p-6">
                            <h3 id="head_children" class="text-lg font-bold text-teal-600 mb-4">Anak Kandung</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="numSons" id="lbl_sons" class="block text-sm font-bold text-slate-600 mb-1">Anak Laki-laki:</label>
                                    <input type="number" id="numSons" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                    <label for="numDaughters" id="lbl_daughters" class="block text-sm font-bold text-slate-600 mb-1">Anak Perempuan:</label>
                                    <input type="number" id="numDaughters" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- Orang Tua -->
                        <div class="neu-flat p-6">
                            <h3 id="head_parents" class="text-lg font-bold text-teal-600 mb-4">Orang Tua Kandung</h3>
                            <div class="space-y-4">
                                <div class="flex items-center">
                                    <input type="checkbox" id="hasFather" class="mr-3">
                                    <label for="hasFather" id="lbl_father" class="text-slate-700 font-medium">Ayah</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="hasMother" class="mr-3">
                                    <label for="hasMother" id="lbl_mother" class="text-slate-700 font-medium">Ibu</label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Kakek & Nenek -->
                        <div class="neu-flat p-6">
                            <h3 id="head_grandparents" class="text-lg font-bold text-teal-600 mb-4">Kakek & Nenek</h3>
                             <div class="space-y-4">
                                <div class="flex items-center">
                                    <input type="checkbox" id="hasPaternalGrandfather" class="mr-3">
                                    <label for="hasPaternalGrandfather" id="lbl_p_grandfather" class="text-slate-700 font-medium leading-tight">Kakek dari Ayah <span class="text-xs text-slate-500 block mt-1">(jika Ayah tiada)</span></label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="hasMaternalGrandmother" class="mr-3">
                                    <label for="hasMaternalGrandmother" id="lbl_m_grandmother" class="text-slate-700 font-medium leading-tight">Nenek dari Ibu <span class="text-xs text-slate-500 block mt-1">(jika Ibu tiada)</span></label>
                                </div>
                                 <div class="flex items-center">
                                    <input type="checkbox" id="hasPaternalGrandmother" class="mr-3">
                                    <label for="hasPaternalGrandmother" id="lbl_p_grandmother" class="text-slate-700 font-medium leading-tight">Nenek dari Ayah <span class="text-xs text-slate-500 block mt-1">(jika Ibu tiada)</span></label>
                                </div>
                            </div>
                        </div>

                        <!-- Cucu -->
                        <div class="neu-flat p-6">
                            <h3 id="head_grandads" class="text-lg font-bold text-teal-600 mb-4">Cucu (dari Anak Lk)</h3>
                             <div class="space-y-4">
                                <div>
                                    <label for="numSonSons" id="lbl_sonSons" class="block text-sm font-bold text-slate-600 mb-1">Cucu Laki-laki:</label>
                                    <input type="number" id="numSonSons" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                    <label for="numSonDaughters" id="lbl_sonDaughters" class="block text-sm font-bold text-slate-600 mb-1">Cucu Perempuan:</label>
                                    <input type="number" id="numSonDaughters" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Saudara -->
                        <div class="neu-flat p-6">
                            <h3 id="head_siblings" class="text-lg font-bold text-teal-600 mb-4">Saudara-saudari</h3>
                            <div class="space-y-3">
                                <div>
                                    <label for="numFullBrothers" id="lbl_fullBrothers" class="block text-sm font-bold text-slate-600 mb-1">Sdr Laki Kandung:</label>
                                    <input type="number" id="numFullBrothers" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                    <label for="numFullSisters" id="lbl_fullSisters" class="block text-sm font-bold text-slate-600 mb-1">Sdri Pr Kandung:</label>
                                    <input type="number" id="numFullSisters" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                     <label for="numPaternalBrothers" id="lbl_paternalBrothers" class="block text-sm font-bold text-slate-600 mb-1">Sdr Laki Seayah:</label>
                                    <input type="number" id="numPaternalBrothers" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                    <label for="numPaternalSisters" id="lbl_paternalSisters" class="block text-sm font-bold text-slate-600 mb-1">Sdri Pr Seayah:</label>
                                    <input type="number" id="numPaternalSisters" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                    <label for="numUterineSiblings" class="block text-sm font-bold text-slate-600 mb-1 flex items-center gap-2">
                                        <span id="lbl_uterineSiblings">Sdr Seibu (Lk & Pr):</span>
                                        <span class="tooltip">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 text-teal-500">
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            <span id="tooltip_uterine" class="tooltiptext text-xs">Total jumlah saudara & saudari seibu. Bagian mereka sama.</span>
                                        </span>
                                    </label>
                                    <input type="number" id="numUterineSiblings" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                            </div>
                        </div>

                         <!-- Keponakan & Paman -->
                        <div class="neu-flat p-6 md:col-span-2 lg:col-span-3">
                            <h3 id="head_relatives" class="text-lg font-bold text-teal-600 mb-4">Kerabat Jauh (Hanya Laki-laki dari Garis Laki-laki)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div>
                                    <label for="numNephewsFromFullBrother" id="lbl_nephewFull" class="block text-sm font-bold text-slate-600 mb-1">Keponakan (dari Sdr Kandung):</label>
                                    <input type="number" id="numNephewsFromFullBrother" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                    <label for="numNephewsFromPaternalBrother" id="lbl_nephewPaternal" class="block text-sm font-bold text-slate-600 mb-1">Keponakan (dari Sdr Seayah):</label>
                                    <input type="number" id="numNephewsFromPaternalBrother" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                    <label for="numFullPaternalUncles" id="lbl_uncleFull" class="block text-sm font-bold text-slate-600 mb-1">Paman Kandung:</label>
                                    <input type="number" id="numFullPaternalUncles" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                    <label for="numPaternalUnclesFromFather" id="lbl_unclePaternal" class="block text-sm font-bold text-slate-600 mb-1">Paman Seayah:</label>
                                    <input type="number" id="numPaternalUnclesFromFather" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                    <label for="numSonsOfFullPaternalUncles" id="lbl_cousinFull" class="block text-sm font-bold text-slate-600 mb-1">Anak Paman Kandung:</label>
                                    <input type="number" id="numSonsOfFullPaternalUncles" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                                <div>
                                    <label for="numSonsOfPaternalUnclesFromFather" id="lbl_cousinPaternal" class="block text-sm font-bold text-slate-600 mb-1">Anak Paman Seayah:</label>
                                    <input type="number" id="numSonsOfPaternalUnclesFromFather" min="0" placeholder="0" class="neu-pressed" value="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-10 text-center space-x-4 rtl:space-x-reverse">
                    <button id="calculateButton" class="neu-btn primary text-lg px-10 py-4">
                        <span class="mr-2 rtl:ml-2 rtl:mr-0">ðŸ§®</span> <span id="btn_calc">Hitung Warisan</span>
                    </button>
                    <button id="resetButton" class="neu-btn secondary text-lg px-10 py-4">
                        <span class="mr-2 rtl:ml-2 rtl:mr-0">â†º</span> <span id="btn_reset">Reset Data</span>
                    </button>
                </div>
            </div>

            <div id="pdfContent" class="rounded-2xl bg-transparent">
                <div id="summary" class="mt-6 space-y-4"></div>
                <div id="results" class="mt-6 space-y-4"></div>
                <div id="hijabSection" class="mt-6"></div>
            </div>
            
            <div id="pdfButtonContainer" class="mt-10 text-center mb-10" style="display: none;">
                 <button id="savePdfButton" class="neu-btn primary px-8 py-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 rtl:ml-2 rtl:mr-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    <span id="btn_pdf">Unduh Hasil PDF</span>
                </button>
                <p id="pdfNote" class="text-xs text-slate-400 mt-2" style="display:none">Note: PDF will be generated in Indonesian for clarity.</p>
            </div>

        </main>

        <footer class="py-8 mt-auto">
            <div class="container mx-auto px-4 text-center">
                <div class="neu-flat inline-block px-8 py-4 rounded-xl">
                    <p id="footer_creator" class="text-sm text-slate-600 font-semibold mb-1">Dibuat oleh : Ust Hendra & Tim Syariah Waris Indonesia</p>
                    <p class="text-xs text-slate-400">&copy; <span id="currentYear"></span> <span id="footer_rights">Kalkulator Waris Islami. Semua Hak Dilindungi.</span></p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="payment-modal-overlay fixed inset-0 z-50 flex items-center justify-center opacity-0 pointer-events-none">
        <div class="payment-modal-content neu-flat p-8 m-4 w-full max-w-lg relative">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-teal-400 to-teal-600 rounded-t-2xl"></div>
            
            <h3 id="modal_title" class="text-2xl font-bold text-teal-700 mb-2 mt-2 text-center">Dukungan Dakwah</h3>
            <p id="modal_desc" class="text-slate-600 text-center mb-6 text-sm">Infaq seikhlasnya untuk pengembangan sistem dan operasional Syariah Waris Indonesia.</p>
            
            <div class="space-y-4 mb-6">
                <div class="neu-pressed p-4 flex justify-between items-center">
                    <div>
                        <h4 class="font-bold text-slate-700">BSI (Bank Syariah Indonesia)</h4>
                        <p class="text-sm text-slate-500">a.n PT SYARIAH WARIS CENTER</p>
                    </div>
                    <p class="font-mono font-bold text-teal-600 text-lg">8880000908</p>
                </div>
                <div class="neu-pressed p-4 flex justify-between items-center">
                    <div>
                        <h4 class="font-bold text-slate-700">Maybank Syariah</h4>
                        <p class="text-sm text-slate-500">a.n SYARIAH WARIS CENTER, PT</p>
                    </div>
                    <p class="font-mono font-bold text-teal-600 text-lg">2.700-000524</p>
                </div>
            </div>

            <p id="modal_quran" class="text-xs text-slate-400 text-center mb-8 italic">"Dan apa saja yang kamu infakkan, Allah akan menggantinya" (QS. Saba': 39)</p>
            
            <div class="flex flex-col md:flex-row gap-3 justify-center">
                <button id="closeModalButton" class="neu-btn secondary text-sm">Nanti Saja</button>
                <button id="confirmPaymentButton" class="neu-btn primary text-sm">Saya Sudah Transfer & Unduh</button>
            </div>
        </div>
    </div>

    <script>
        // --- LOCK SCREEN LOGIC ---
        const correctPassword = "Bismillah_@123";
        const passwordInput = document.getElementById('passwordInput');
        const unlockButton = document.getElementById('unlockButton');
        const passwordError = document.getElementById('passwordError');
        const lockScreen = document.getElementById('lockScreen');

        function checkPassword() {
            if (passwordInput.value === correctPassword) {
                document.body.classList.add('unlocked');
                // Optional: Focus on first input
                setTimeout(() => document.getElementById('deceasedName').focus(), 500);
            } else {
                passwordError.classList.remove('hidden');
                lockScreen.querySelector('div').classList.add('shake');
                setTimeout(() => {
                    lockScreen.querySelector('div').classList.remove('shake');
                }, 500);
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        unlockButton.addEventListener('click', checkPassword);
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkPassword();
        });

        // --- EXISTING LOGIC ---
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if (e.keyCode == 123) return false;
            if (e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0))) return false;
            if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
        }

        document.getElementById('currentYear').textContent = new Date().getFullYear();
        const { jsPDF } = window.jspdf; 

        let latestCalculationResult = null; 
        let currentLang = 'id';
        
        const translations = {
            id: {
                title: "Kalkulator Waris Islami",
                desc: "Hitung pembagian harta warisan sesuai syariat Islam secara presisi.",
                s1: "Rincian Harta & Kewajiban",
                deceasedName: "Nama Almarhum/ah:",
                totalHarta: "Total Harta (Rp):",
                hutang: "Hutang (Rp):",
                biayaJenazah: "Biaya Jenazah (Rp):",
                wasiat: "Wasiat (Rp)",
                tooltip_wasiat: "Maksimal 1/3 dari harta bersih. Otomatis disesuaikan jika melebihi.",
                gender: "Jenis Kelamin:",
                male: "Laki-laki",
                female: "Perempuan",
                s2: "Informasi Ahli Waris",
                heirHint: "Masukkan jumlah ahli waris. Kosongkan atau isi 0 jika tidak ada.",
                h_spouse: "Pasangan",
                lbl_husband: "Suami (jika almarhumah perempuan)",
                lbl_wives: "Jumlah Istri:",
                h_children: "Anak Kandung",
                lbl_sons: "Anak Laki-laki:",
                lbl_daughters: "Anak Perempuan:",
                h_parents: "Orang Tua Kandung",
                lbl_father: "Ayah",
                lbl_mother: "Ibu",
                h_grandparents: "Kakek & Nenek",
                lbl_pgf: "Kakek dari Ayah (jika Ayah tiada)",
                lbl_mgm: "Nenek dari Ibu (jika Ibu tiada)",
                lbl_pgm: "Nenek dari Ayah (jika Ibu tiada)",
                h_grandads: "Cucu (dari Anak Lk)",
                lbl_ss: "Cucu Laki-laki:",
                lbl_sd: "Cucu Perempuan:",
                h_siblings: "Saudara-saudari",
                lbl_fb: "Sdr Laki Kandung:",
                lbl_fs: "Sdri Pr Kandung:",
                lbl_pb: "Sdr Laki Seayah:",
                lbl_ps: "Sdri Pr Seayah:",
                lbl_us: "Sdr Seibu (Lk & Pr):",
                tt_us: "Total jumlah saudara & saudari seibu. Bagian mereka sama.",
                h_relatives: "Kerabat Jauh (Hanya Laki-laki dari Garis Laki-laki)",
                lbl_nf: "Keponakan (dari Sdr Kandung):",
                lbl_np: "Keponakan (dari Sdr Seayah):",
                lbl_uf: "Paman Kandung:",
                lbl_up: "Paman Seayah:",
                lbl_cf: "Anak Paman Kandung:",
                lbl_cp: "Anak Paman Seayah:",
                btn_calc: "Hitung Warisan",
                btn_reset: "Reset Data",
                btn_pdf: "Unduh Hasil PDF",
                creator: "Dibuat oleh : Ust Hendra & Tim Syariah Waris Indonesia",
                rights: "Kalkulator Waris Islami. Semua Hak Dilindungi.",
                m_title: "Dukungan Dakwah",
                m_desc: "Infaq seikhlasnya untuk pengembangan sistem dan operasional Syariah Waris Indonesia.",
                m_later: "Nanti Saja",
                m_ok: "Saya Sudah Transfer & Unduh",
                res_title: "Hasil Pembagian",
                sum_title: "Ringkasan Harta",
                sum_net: "Harta Waris Bersih",
                alert_invalid: "Input Tidak Valid! Harta harus lebih dari 0 jika ada kewajiban.",
                alert_no_asset: "Tidak ada harta dimasukkan. Perhitungan teoritis ditampilkan.",
                alert_insufficient: "Harta Tidak Cukup! Habis untuk hutang/biaya jenazah.",
                alert_exhausted: "Harta Habis setelah wasiat/kewajiban.",
                alert_no_heir: "Tidak Ada Ahli Waris yang berhak.",
                mahjub_title: "Ahli Waris Terhalang (Mahjub)",
                mahjub_desc: "Tidak mendapat bagian karena ada ahli waris lain yang lebih dekat:",
                share: "Bagian",
                amount: "Nominal",
                placeholder_name: "Contoh: Muhammad Ali"
            },
            en: {
                title: "Islamic Inheritance Calculator",
                desc: "Calculate inheritance distribution according to Islamic Sharia accurately.",
                s1: "Assets & Liabilities",
                deceasedName: "Deceased Name:",
                totalHarta: "Total Assets (Rp):",
                hutang: "Debts (Rp):",
                biayaJenazah: "Funeral Costs (Rp):",
                wasiat: "Bequest/Wasiat (Rp)",
                tooltip_wasiat: "Max 1/3 of net assets. Auto-adjusted if exceeded.",
                gender: "Gender:",
                male: "Male",
                female: "Female",
                s2: "Heirs Information",
                heirHint: "Enter number of heirs. Leave empty or 0 if none.",
                h_spouse: "Spouse",
                lbl_husband: "Husband (if deceased was female)",
                lbl_wives: "Number of Wives:",
                h_children: "Children",
                lbl_sons: "Sons:",
                lbl_daughters: "Daughters:",
                h_parents: "Parents",
                lbl_father: "Father",
                lbl_mother: "Mother",
                h_grandparents: "Grandparents",
                lbl_pgf: "Paternal Grandfather (if Father absent)",
                lbl_mgm: "Maternal Grandmother (if Mother absent)",
                lbl_pgm: "Paternal Grandmother (if Mother absent)",
                h_grandads: "Grandchildren (from Son)",
                lbl_ss: "Grandson:",
                lbl_sd: "Granddaughter:",
                h_siblings: "Siblings",
                lbl_fb: "Full Brother:",
                lbl_fs: "Full Sister:",
                lbl_pb: "Paternal Brother:",
                lbl_ps: "Paternal Sister:",
                lbl_us: "Maternal Siblings (M/F):",
                tt_us: "Total count. They share equally.",
                h_relatives: "Distant Relatives (Male Line Only)",
                lbl_nf: "Nephew (from Full Bro):",
                lbl_np: "Nephew (from Pat. Bro):",
                lbl_uf: "Full Uncle:",
                lbl_up: "Paternal Uncle:",
                lbl_cf: "Son of Full Uncle:",
                lbl_cp: "Son of Pat. Uncle:",
                btn_calc: "Calculate",
                btn_reset: "Reset",
                btn_pdf: "Download PDF Result",
                creator: "Created by: Ust Hendra & Syariah Waris Indonesia Team",
                rights: "Islamic Inheritance Calculator. All Rights Reserved.",
                m_title: "Support Our Dawah",
                m_desc: "Voluntary donation for system development and operations.",
                m_later: "Maybe Later",
                m_ok: "I Have Transferred & Download",
                res_title: "Distribution Results",
                sum_title: "Assets Summary",
                sum_net: "Net Inheritance Assets",
                alert_invalid: "Invalid Input! Assets must be > 0 if liabilities exist.",
                alert_no_asset: "No assets entered. Theoretical calculation shown.",
                alert_insufficient: "Insufficient Assets! Consumed by debts/funeral costs.",
                alert_exhausted: "Assets Exhausted after bequest/liabilities.",
                alert_no_heir: "No eligible heirs found.",
                mahjub_title: "Blocked Heirs (Mahjub)",
                mahjub_desc: "Blocked by closer relatives:",
                share: "Share",
                amount: "Amount",
                placeholder_name: "Ex: Muhammad Ali"
            },
            ar: {
                title: "Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ÙŠØ±Ø§Ø« Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ",
                desc: "Ø­Ø³Ø§Ø¨ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…ÙŠØ±Ø§Ø« ÙˆÙÙ‚ Ø§Ù„Ø´Ø±ÙŠØ¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ø¨Ø¯Ù‚Ø©.",
                s1: "ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ±ÙƒØ© ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª",
                deceasedName: "Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰:",
                totalHarta: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ±ÙƒØ© (Ø±ÙˆØ¨ÙŠØ©):",
                hutang: "Ø§Ù„Ø¯ÙŠÙˆÙ†:",
                biayaJenazah: "ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø¬Ù†Ø§Ø²Ø©:",
                wasiat: "Ø§Ù„ÙˆØµÙŠØ©",
                tooltip_wasiat: "Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 1/3 Ù…Ù† Ø§Ù„ØªØ±ÙƒØ© Ø§Ù„ØµØ§ÙÙŠØ©.",
                gender: "Ø§Ù„Ø¬Ù†Ø³:",
                male: "Ø°ÙƒØ±",
                female: "Ø£Ù†Ø«Ù‰",
                s2: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ±Ø«Ø©",
                heirHint: "Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø«Ø©. Ø§ØªØ±Ùƒ ÙØ§Ø±ØºÙ‹Ø§ Ø£Ùˆ 0 Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯.",
                h_spouse: "Ø§Ù„Ø²ÙˆØ¬ / Ø§Ù„Ø²ÙˆØ¬Ø©",
                lbl_husband: "Ø§Ù„Ø²ÙˆØ¬ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ØªÙˆÙÙ‰ Ø£Ù†Ø«Ù‰)",
                lbl_wives: "Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ¬Ø§Øª:",
                h_children: "Ø§Ù„Ø£ÙˆÙ„Ø§Ø¯",
                lbl_sons: "Ø§Ù„Ø§Ø¨Ù†:",
                lbl_daughters: "Ø§Ù„Ø¨Ù†Øª:",
                h_parents: "Ø§Ù„ÙˆØ§Ù„Ø¯Ø§Ù†",
                lbl_father: "Ø§Ù„Ø£Ø¨",
                lbl_mother: "Ø§Ù„Ø£Ù…",
                h_grandparents: "Ø§Ù„Ø¬Ø¯ ÙˆØ§Ù„Ø¬Ø¯Ø©",
                lbl_pgf: "Ø§Ù„Ø¬Ø¯ Ù„Ø£Ø¨ (Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ø¨)",
                lbl_mgm: "Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ù… (Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ù…)",
                lbl_pgm: "Ø§Ù„Ø¬Ø¯Ø© Ù„Ø£Ø¨ (Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ù…)",
                h_grandads: "Ø§Ù„Ø£Ø­ÙØ§Ø¯ (Ù…Ù† Ø§Ù„Ø§Ø¨Ù†)",
                lbl_ss: "Ø§Ø¨Ù† Ø§Ù„Ø§Ø¨Ù†:",
                lbl_sd: "Ø¨Ù†Øª Ø§Ù„Ø§Ø¨Ù†:",
                h_siblings: "Ø§Ù„Ø¥Ø®ÙˆØ© ÙˆØ§Ù„Ø£Ø®ÙˆØ§Øª",
                lbl_fb: "Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚:",
                lbl_fs: "Ø§Ù„Ø£Ø®Øª Ø§Ù„Ø´Ù‚ÙŠÙ‚Ø©:",
                lbl_pb: "Ø§Ù„Ø£Ø® Ù„Ø£Ø¨:",
                lbl_ps: "Ø§Ù„Ø£Ø®Øª Ù„Ø£Ø¨:",
                lbl_us: "Ø§Ù„Ø¥Ø®ÙˆØ© Ù„Ø£Ù… (Ø°ÙƒÙˆØ± ÙˆØ¥Ù†Ø§Ø«):",
                tt_us: "Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ. ÙŠØªÙ‚Ø§Ø³Ù…ÙˆÙ† Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ.",
                h_relatives: "Ø§Ù„Ø¹ØµØ¨Ø§Øª (Ø§Ù„Ø°ÙƒÙˆØ± ÙÙ‚Ø·)",
                lbl_nf: "Ø§Ø¨Ù† Ø§Ù„Ø£Ø® Ø§Ù„Ø´Ù‚ÙŠÙ‚:",
                lbl_np: "Ø§Ø¨Ù† Ø§Ù„Ø£Ø® Ù„Ø£Ø¨:",
                lbl_uf: "Ø§Ù„Ø¹Ù… Ø§Ù„Ø´Ù‚ÙŠÙ‚:",
                lbl_up: "Ø§Ù„Ø¹Ù… Ù„Ø£Ø¨:",
                lbl_cf: "Ø§Ø¨Ù† Ø§Ù„Ø¹Ù… Ø§Ù„Ø´Ù‚ÙŠÙ‚:",
                lbl_cp: "Ø§Ø¨Ù† Ø§Ù„Ø¹Ù… Ù„Ø£Ø¨:",
                btn_calc: "Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙŠØ±Ø§Ø«",
                btn_reset: "Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†",
                btn_pdf: "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© PDF",
                creator: "ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø©: Ø§Ù„Ø£Ø³ØªØ§Ø° Ù‡Ù†Ø¯Ø±Ø§ ÙˆÙØ±ÙŠÙ‚ Ø¥Ø±Ø« Ø§Ù„Ø´Ø±ÙŠØ¹Ø© Ø§Ù„Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠ",
                rights: "Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ÙŠØ±Ø§Ø« Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.",
                m_title: "Ø¯Ø¹Ù… Ø§Ù„Ø¯Ø¹ÙˆØ©",
                m_desc: "ØªØ¨Ø±Ø¹ Ø·ÙˆØ¹ÙŠ Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª.",
                m_later: "Ø±Ø¨Ù…Ø§ Ù„Ø§Ø­Ù‚Ø§",
                m_ok: "Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØªØ­Ù…ÙŠÙ„",
                res_title: "Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙˆØ²ÙŠØ¹",
                sum_title: "Ù…Ù„Ø®Øµ Ø§Ù„ØªØ±ÙƒØ©",
                sum_net: "ØµØ§ÙÙŠ Ø§Ù„ØªØ±ÙƒØ© Ù„Ù„Ù…ÙŠØ±Ø§Ø«",
                alert_invalid: "Ø¥Ø¯Ø®Ø§Ù„ ØºÙŠØ± ØµØ§Ù„Ø­! ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ØªØ±ÙƒØ© > 0.",
                alert_no_asset: "Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø£ØµÙˆÙ„. ÙŠØ¸Ù‡Ø± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø¸Ø±ÙŠ.",
                alert_insufficient: "Ø§Ù„ØªØ±ÙƒØ© Ù„Ø§ ØªÙƒÙÙŠ! Ø§Ø³ØªÙ‡Ù„ÙƒØªÙ‡Ø§ Ø§Ù„Ø¯ÙŠÙˆÙ†.",
                alert_exhausted: "Ù†ÙØ¯Øª Ø§Ù„ØªØ±ÙƒØ© Ø¨Ø¹Ø¯ Ø§Ù„ÙˆØµÙŠØ©.",
                alert_no_heir: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØ±Ø«Ø© Ù…Ø³ØªØ­Ù‚ÙˆÙ†.",
                mahjub_title: "Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ù…Ø­Ø¬ÙˆØ¨ÙˆÙ†",
                mahjub_desc: "Ù„Ø§ ÙŠØ±Ø«ÙˆÙ† Ù„ÙˆØ¬ÙˆØ¯ Ù…Ù† Ù‡Ùˆ Ø£Ù‚Ø±Ø¨ Ù…Ù†Ù‡Ù…:",
                share: "Ø§Ù„Ø­ØµØ©",
                amount: "Ø§Ù„Ù…Ù‚Ø¯Ø§Ø±",
                placeholder_name: "Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ"
            }
        };

        const pdfLabels = {
            husband: "Suami",
            wives: "Istri",
            sons: "Anak Laki-laki",
            daughters: "Anak Perempuan",
            father: "Ayah",
            mother: "Ibu",
            paternalGrandfather: "Kakek (dari Ayah)",
            maternalGrandmother: "Nenek (dari Ibu)",
            paternalGrandmother: "Nenek (dari Ayah)",
            sonSons: "Cucu Laki-laki",
            sonDaughters: "Cucu Perempuan",
            fullBrothers: "Sdr Laki Kandung",
            fullSisters: "Sdri Perempuan Kandung",
            paternalBrothers: "Sdr Laki Seayah",
            paternalSisters: "Sdri Perempuan Seayah",
            uterineSiblings: "Sdr Seibu",
            nephewsFromFullBrother: "Keponakan (Sdr Kandung)",
            nephewsFromPaternalBrother: "Keponakan (Sdr Seayah)",
            fullPaternalUncles: "Paman Kandung",
            paternalUnclesFromFather: "Paman Seayah",
            sonsOfFullPaternalUncles: "Anak Paman Kandung",
            sonsOfPaternalUnclesFromFather: "Anak Paman Seayah",
            musytarakahGroup: "Musytarakah"
        };

        function changeLanguage(lang) {
            currentLang = lang;
            const d = translations[lang];
            const isAr = lang === 'ar';

            document.body.setAttribute('dir', isAr ? 'rtl' : 'ltr');
            document.body.className = isAr ? 'min-h-screen flex flex-col lang-ar' : 'min-h-screen flex flex-col';

            ['id', 'en', 'ar'].forEach(l => {
                const btn = document.getElementById(`btn-${l}`);
                if(l === lang) btn.classList.add('active-lang');
                else btn.classList.remove('active-lang');
            });

            const mapping = {
                appTitle: 'title', appDesc: 'desc', lbl_section1: 's1', lbl_deceasedName: 'deceasedName',
                lbl_totalHarta: 'totalHarta', lbl_hutang: 'hutang', lbl_biayaJenazah: 'biayaJenazah',
                lbl_wasiat: 'wasiat', tooltip_wasiat: 'tooltip_wasiat', lbl_gender: 'gender',
                opt_male: 'male', opt_female: 'female', lbl_section2: 's2', lbl_heirHint: 'heirHint',
                head_spouse: 'h_spouse', lbl_husband: 'lbl_husband', lbl_wives: 'lbl_wives',
                head_children: 'h_children', lbl_sons: 'lbl_sons', lbl_daughters: 'lbl_daughters',
                head_parents: 'h_parents', lbl_father: 'lbl_father', lbl_mother: 'lbl_mother',
                head_grandparents: 'h_grandparents', lbl_p_grandfather: 'lbl_pgf', lbl_m_grandmother: 'lbl_mgm', lbl_p_grandmother: 'lbl_pgm',
                head_grandads: 'h_grandads', lbl_sonSons: 'lbl_ss', lbl_sonDaughters: 'lbl_sd',
                head_siblings: 'h_siblings', lbl_fullBrothers: 'lbl_fb', lbl_fullSisters: 'lbl_fs',
                lbl_paternalBrothers: 'lbl_pb', lbl_paternalSisters: 'lbl_ps', lbl_uterineSiblings: 'lbl_us', tooltip_uterine: 'tt_us',
                head_relatives: 'h_relatives', lbl_nephewFull: 'lbl_nf', lbl_nephewPaternal: 'lbl_np',
                lbl_uncleFull: 'lbl_uf', lbl_unclePaternal: 'lbl_up', lbl_cousinFull: 'lbl_cf', lbl_cousinPaternal: 'lbl_cp',
                btn_calc: 'btn_calc', btn_reset: 'btn_reset', btn_pdf: 'btn_pdf',
                footer_creator: 'creator', footer_rights: 'rights',
                modal_title: 'm_title', modal_desc: 'm_desc', closeModalButton: 'm_later', confirmPaymentButton: 'm_ok'
            };

            for(const [id, key] of Object.entries(mapping)) {
                const el = document.getElementById(id);
                if(el) {
                    if(el.tagName === 'INPUT') el.placeholder = d[key];
                    else el.innerHTML = d[key]; 
                }
            }
            document.getElementById('deceasedName').placeholder = d.placeholder_name;
            document.getElementById('pdfNote').style.display = isAr ? 'block' : 'none';

            if(document.getElementById('results').innerHTML !== '') {
                document.getElementById('calculateButton').click();
            }
        }

        function getNumValue(id) {
            const val = parseFloat(document.getElementById(id).value);
            return isNaN(val) || val < 0 ? 0 : val;
        }

        function getIntValue(id) {
            const val = parseInt(document.getElementById(id).value);
            return isNaN(val) || val < 0 ? 0 : val;
        }

        function getCheckboxValue(id) {
            return document.getElementById(id).checked;
        }
        
        document.getElementById('calculateButton').addEventListener('click', function() {
            const langData = translations[currentLang];
            const deceasedName = document.getElementById('deceasedName').value || "Almarhum/ah";
            const totalHartaPeninggalan = getNumValue('totalHartaPeninggalan');
            const hutang = getNumValue('hutang');
            const biayaJenazah = getNumValue('biayaJenazah');
            const wasiatInput = getNumValue('wasiat');

            const summaryDiv = document.getElementById('summary');
            const resultsDiv = document.getElementById('results');
            const hijabDiv = document.getElementById('hijabSection');
            const pdfButtonContainer = document.getElementById('pdfButtonContainer');
            
            summaryDiv.innerHTML = '';
            resultsDiv.innerHTML = '';
            hijabDiv.innerHTML = '';
            pdfButtonContainer.style.display = 'none';

            latestCalculationResult = null;

            if (totalHartaPeninggalan <= 0 && (hutang > 0 || biayaJenazah > 0 || wasiatInput > 0)) {
                 summaryDiv.innerHTML = `<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md" role="alert"><p class="font-bold">${langData.alert_invalid}</p></div>`;
                return;
            }
             if (totalHartaPeninggalan <= 0 && hutang <= 0 && biayaJenazah <= 0 && wasiatInput <=0) {
                 summaryDiv.innerHTML = `<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md shadow-md" role="alert"><p class="font-bold">${langData.alert_no_asset}</p></div>`;
            }

            let hartaSetelahBiayaDanHutang = totalHartaPeninggalan - hutang - biayaJenazah;
            let wasiatMessage = "";

            if (hartaSetelahBiayaDanHutang < 0) {
                summaryDiv.innerHTML = `<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md" role="alert"><p class="font-bold">${langData.alert_insufficient}</p></div>`;
                pdfButtonContainer.style.display = 'block'; 
                return;
            }

            const maksWasiat = hartaSetelahBiayaDanHutang > 0 ? hartaSetelahBiayaDanHutang / 3 : 0;
            let wasiatSebenarnya = wasiatInput;

            if (wasiatInput > maksWasiat) {
                wasiatSebenarnya = maksWasiat;
                wasiatMessage = " (*)";
            }
            
            wasiatSebenarnya = Math.min(wasiatSebenarnya, hartaSetelahBiayaDanHutang);
            const estateValue = hartaSetelahBiayaDanHutang - wasiatSebenarnya;

            summaryDiv.innerHTML = `
                <div class="neu-flat p-6 mb-4 rounded-lg">
                    <h3 class="text-xl font-bold text-teal-700 mb-4 border-b border-gray-300 pb-2">${langData.sum_title}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                        <p>${langData.totalHarta}</p> <p class="font-bold text-right">Rp ${totalHartaPeninggalan.toLocaleString('id-ID')}</p>
                        <p>${langData.hutang}</p> <p class="font-bold text-right text-red-500">- Rp ${hutang.toLocaleString('id-ID')}</p>
                        <p>${langData.biayaJenazah}</p> <p class="font-bold text-right text-red-500">- Rp ${biayaJenazah.toLocaleString('id-ID')}</p>
                        <p>${langData.wasiat}</p> <p class="font-bold text-right text-orange-500">- Rp ${wasiatSebenarnya.toLocaleString('id-ID')}${wasiatMessage}</p>
                    </div>
                    <hr class="my-3 border-slate-300">
                    <div class="flex justify-between items-center">
                        <p class="font-bold text-teal-600 text-lg">${langData.sum_net}:</p>
                        <p class="font-extrabold text-teal-700 text-xl">Rp ${(estateValue < 0 ? 0 : estateValue).toLocaleString('id-ID',{minimumFractionDigits: 0, maximumFractionDigits: 2})}</p>
                    </div>
                </div>
            `;

            if (estateValue < EPSILON && totalHartaPeninggalan > 0) {
                 summaryDiv.innerHTML += `<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md shadow-md mt-2" role="alert"><p class="font-bold">${langData.alert_exhausted}</p></div>`;
                pdfButtonContainer.style.display = 'block'; 
                return;
            }
            
            const deceasedGender = document.getElementById('deceasedGender').value;
            const hasHusband = deceasedGender === 'female' && getCheckboxValue('hasHusband');
            const numWives = deceasedGender === 'male' ? getIntValue('numWives') : 0;
            const numSons = getIntValue('numSons');
            const numDaughters = getIntValue('numDaughters');
            const hasFatherState = getCheckboxValue('hasFather'); 
            const hasMotherState = getCheckboxValue('hasMother'); 
            const hasPaternalGrandfather = !hasFatherState && getCheckboxValue('hasPaternalGrandfather');
            const hasMaternalGrandmother = !hasMotherState && getCheckboxValue('hasMaternalGrandmother');
            const hasPaternalGrandmother = !hasMotherState && getCheckboxValue('hasPaternalGrandmother'); 
            const numSonSons = getIntValue('numSonSons');
            const numSonDaughters = getIntValue('numSonDaughters');
            const numFullBrothers = getIntValue('numFullBrothers');
            const numFullSisters = getIntValue('numFullSisters');
            const numPaternalBrothers = getIntValue('numPaternalBrothers');
            const numPaternalSisters = getIntValue('numPaternalSisters');
            const numUterineSiblings = getIntValue('numUterineSiblings'); 
            const numNephewsFromFullBrother = getIntValue('numNephewsFromFullBrother');
            const numNephewsFromPaternalBrother = getIntValue('numNephewsFromPaternalBrother');
            const numFullPaternalUncles = getIntValue('numFullPaternalUncles');
            const numPaternalUnclesFromFather = getIntValue('numPaternalUnclesFromFather');
            const numSonsOfFullPaternalUncles = getIntValue('numSonsOfFullPaternalUncles');
            const numSonsOfPaternalUnclesFromFather = getIntValue('numSonsOfPaternalUnclesFromFather');

            let heirs = {}; 
            let totalFixedShares = 0; 
            let faraidRemainingPortion = 1.0; 

            const hasChildren = numSons > 0 || numDaughters > 0;
            const hasSon = numSons > 0;
            const hasGrandChildrenFromSon = numSonSons > 0 || numSonDaughters > 0;
            const hasMaleDescendants = numSons > 0 || numSonSons > 0; 
            const hasDescendants = hasChildren || hasGrandChildrenFromSon; 
            const numTotalFullSiblings = numFullBrothers + numFullSisters;
            const numTotalPaternalSiblings = numPaternalBrothers + numPaternalSisters;
            const numSiblingsTotal = numTotalFullSiblings + numTotalPaternalSiblings + numUterineSiblings;
            
            const isGharawainCase = hasMotherState && hasFatherState && (hasHusband || numWives > 0) && !hasDescendants && numSiblingsTotal < 2;
            const isMusytarakahCase = hasHusband && hasMotherState && numUterineSiblings >= 2 && numTotalFullSiblings > 0 && !hasDescendants && !hasFatherState && !hasPaternalGrandfather;
            
            let mahjubHeirs = [];
            const hList = {
                sonSons: { k: 'sonSons', n: langData.lbl_ss, c: numSonSons > 0, b: hasSon },
                sonDaughters: { k: 'sonDaughters', n: langData.lbl_sd, c: numSonDaughters > 0, b: hasSon },
                paternalGrandfather: { k: 'paternalGrandfather', n: langData.lbl_pgf, c: hasPaternalGrandfather, b: hasFatherState },
                maternalGrandmother: { k: 'maternalGrandmother', n: langData.lbl_mgm, c: hasMaternalGrandmother, b: hasMotherState },
                paternalGrandmother: { k: 'paternalGrandmother', n: langData.lbl_pgm, c: hasPaternalGrandmother, b: hasMotherState || hasFatherState },
                fullBrothers: { k: 'fullBrothers', n: langData.lbl_fb, c: numFullBrothers > 0, b: hasSon || numSonSons>0 || hasFatherState || hasPaternalGrandfather },
                fullSisters: { k: 'fullSisters', n: langData.lbl_fs, c: numFullSisters > 0, b: hasSon || numSonSons>0 || hasFatherState || hasPaternalGrandfather },
                paternalBrothers: { k: 'paternalBrothers', n: langData.lbl_pb, c: numPaternalBrothers > 0, b: hasSon || numSonSons>0 || hasFatherState || hasPaternalGrandfather || numFullBrothers > 0 || numFullSisters > 0 },
                paternalSisters: { k: 'paternalSisters', n: langData.lbl_ps, c: numPaternalSisters > 0, b: hasSon || numSonSons>0 || hasFatherState || hasPaternalGrandfather || numFullBrothers > 0 || (numFullSisters > 0 && !isMusytarakahCase && !hasDescendants && !hasFatherState && !hasPaternalGrandfather) },
                uterineSiblings: { k: 'uterineSiblings', n: langData.lbl_us, c: numUterineSiblings > 0, b: hasDescendants || hasFatherState || hasPaternalGrandfather },
                nf: { k: 'nephewsFromFullBrother', n: langData.lbl_nf, c: numNephewsFromFullBrother > 0, b: true },
            };
             
            for(const key in hList) {
                if(hList[key].c && hList[key].b) mahjubHeirs.push({key: hList[key].k, name: hList[key].n});
            }

            if (hasHusband) {
                heirs.husband = { share: hasDescendants ? 1/4 : 1/2, note: hasDescendants ? "1/4" : "1/2" };
                totalFixedShares += heirs.husband.share;
            } else if (numWives > 0) {
                heirs.wives = { share: hasDescendants ? 1/8 : 1/4, note: hasDescendants ? "1/8" : "1/4" };
                totalFixedShares += heirs.wives.share;
            }
            if (hasMotherState) {
                if (isGharawainCase) {
                    let spouseShareForGharawain = heirs.husband?.share || heirs.wives?.share || 0;
                    heirs.mother = { share: (1.0 - spouseShareForGharawain) / 3, note: "Gharawain"};
                } else if (hasDescendants || numSiblingsTotal >= 2) {
                    heirs.mother = { share: 1/6, note: "1/6" };
                } else {
                    heirs.mother = { share: 1/3, note: "1/3" };
                }
                totalFixedShares += heirs.mother.share;
            }

            let uterineSiblingsBlocked = hasDescendants || hasFatherState || hasPaternalGrandfather;
            if (isMusytarakahCase) {
                const musytarakahShare = 1/3;
                heirs.musytarakahGroup = { share: musytarakahShare, note: "Musytarakah" };
                totalFixedShares += musytarakahShare;
            } else if (!uterineSiblingsBlocked && numUterineSiblings > 0) {
                heirs.uterineSiblings = { share: numUterineSiblings === 1 ? 1/6 : 1/3, note: numUterineSiblings===1 ? "1/6" : "1/3" };
                totalFixedShares += heirs.uterineSiblings.share;
            }

            if (hasFatherState && !isGharawainCase) { 
                if (hasMaleDescendants) { 
                    heirs.father = { share: 1/6, note: "1/6" };
                    totalFixedShares += heirs.father.share;
                } else if (hasDescendants) { 
                     heirs.father = { share: 1/6, note: "1/6 + Sisa" };
                     totalFixedShares += heirs.father.share; 
                }
            }

            if (hasPaternalGrandfather && !hasFatherState) { 
                if (hasMaleDescendants) {
                    heirs.paternalGrandfather = { share: 1/6, note: "1/6" };
                    totalFixedShares += heirs.paternalGrandfather.share;
                } else if (hasDescendants) { 
                    heirs.paternalGrandfather = { share: 1/6, note: "1/6 + Sisa" };
                    totalFixedShares += heirs.paternalGrandfather.share;
                }
            }

            let maternalGrandmotherOriginalShare = 0;
            if (hasMaternalGrandmother && !hasMotherState) { 
                 maternalGrandmotherOriginalShare = 1/6;
                 heirs.maternalGrandmother = { share: 1/6, note: "1/6" };
                 totalFixedShares += heirs.maternalGrandmother.share;
            }
            if (hasPaternalGrandmother && !hasMotherState) {
                if (heirs.maternalGrandmother && maternalGrandmotherOriginalShare === 1/6) { 
                    totalFixedShares -= maternalGrandmotherOriginalShare; 
                    heirs.maternalGrandmother.share = 1/12; 
                    totalFixedShares += 1/12; 
                    heirs.paternalGrandmother = { share: 1/12, note: "1/12" };
                    totalFixedShares += 1/12; 
                } else {
                    heirs.paternalGrandmother = { share: 1/6, note: "1/6" };
                    totalFixedShares += heirs.paternalGrandmother.share;
                }
            }

            if (numDaughters > 0 && !hasSon) { 
                heirs.daughters = { share: numDaughters === 1 ? 1/2 : 2/3, note: numDaughters === 1 ? "1/2" : "2/3" };
                totalFixedShares += heirs.daughters.share;
            }

            if (numSonDaughters > 0 && !hasSon && !numSonSons) { 
                if (!hasChildren) { 
                    heirs.sonDaughters = { share: numSonDaughters === 1 ? 1/2 : 2/3, note: numSonDaughters===1 ? "1/2" : "2/3" };
                    totalFixedShares += heirs.sonDaughters.share;
                } else if (numDaughters === 1 && heirs.daughters?.share === 1/2) { 
                    heirs.sonDaughters = { share: 1/6, note: "1/6 (Takmilah)" };
                    totalFixedShares += heirs.sonDaughters.share;
                }
            }

            let fullSistersEligibleForFixedShare = numFullSisters > 0 && !hasDescendants && !hasFatherState && !hasPaternalGrandfather && !numFullBrothers && !musytarakahApplied;
            if (fullSistersEligibleForFixedShare) {
                heirs.fullSisters = { share: numFullSisters === 1 ? 1/2 : 2/3, note: numFullSisters===1 ? "1/2" : "2/3" };
                totalFixedShares += heirs.fullSisters.share;
            }

            faraidRemainingPortion = 1.0 - totalFixedShares;
            let asabahTookAllRemainder = false;

            if (faraidRemainingPortion > EPSILON || totalFixedShares < (1.0 - EPSILON) ) { 
                 if (isGharawainCase && hasFatherState) {
                    let residue = 1.0 - (heirs.husband?.share||heirs.wives?.share||0) - heirs.mother.share;
                    heirs.father = { share: residue, note: "Ashobah (Gharawain)" };
                    asabahTookAllRemainder = true;
                } else if (numSons > 0) { 
                    if (heirs.daughters) { totalFixedShares -= heirs.daughters.share; delete heirs.daughters; }
                    faraidRemainingPortion = 1.0 - totalFixedShares; 
                    let totalParts = (numSons * 2) + numDaughters;
                    heirs.sons = { share: (numSons * 2 / totalParts) * faraidRemainingPortion, note: "Ashobah bin Nafsi" };
                    if (numDaughters > 0) heirs.daughters = { share: (numDaughters * 1 / totalParts) * faraidRemainingPortion, note: "Ashobah bil Ghair" };
                    asabahTookAllRemainder = true;
                } 
            }
            
            if (isMusytarakahCase && heirs.musytarakahGroup) {
                const totalParticipating = numUterineSiblings + numFullBrothers + numFullSisters;
                if (totalParticipating > 0) {
                    const s = heirs.musytarakahGroup.share / totalParticipating;
                    if (numUterineSiblings > 0) heirs.uterineSiblings = { share: s * numUterineSiblings, note: "Musytarakah" };
                    if (numFullBrothers > 0) heirs.fullBrothers = { share: s * numFullBrothers, note: "Musytarakah" };
                    if (numFullSisters > 0) heirs.fullSisters = { share: s * numFullSisters, note: "Musytarakah" };
                    delete heirs.musytarakahGroup;
                }
            }

            let currentTotalAssignedShares = 0;
            for (const k in heirs) if (heirs[k]) currentTotalAssignedShares += heirs[k].share;

            if (currentTotalAssignedShares > 1.0 + EPSILON) { 
                resultsDiv.innerHTML += `<div class="my-4 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 rounded-md shadow-sm"><p class="font-bold">${langData.aul}</p></div>`;
                const aulFactor = currentTotalAssignedShares;
                for (const k in heirs) if (heirs[k]) heirs[k].share /= aulFactor;
            } else if (currentTotalAssignedShares < (1.0 - EPSILON) && !asabahTookAllRemainder) { 
                resultsDiv.innerHTML += `<div class="my-4 p-4 bg-sky-100 border-l-4 border-sky-500 text-sky-700 rounded-md shadow-sm"><p class="font-bold">${langData.radd}</p></div>`;
                let raddRemainder = 1.0 - currentTotalAssignedShares;
                let eligibleSum = 0;
                for (const k in heirs) if (k !== 'husband' && k !== 'wives') eligibleSum += heirs[k].share;
                
                if (eligibleSum > EPSILON) {
                    for (const k in heirs) if (k !== 'husband' && k !== 'wives') heirs[k].share += (heirs[k].share / eligibleSum) * raddRemainder;
                } else if (heirs.husband || heirs.wives) {
                    if(heirs.husband) heirs.husband.share += raddRemainder;
                    if(heirs.wives) heirs.wives.share += raddRemainder;
                }
            }

            latestCalculationResult = {
                deceasedName: deceasedName,
                totalHarta: totalHartaPeninggalan,
                hutang: hutang,
                biayaJenazah: biayaJenazah,
                wasiat: wasiatSebenarnya,
                netEstate: estateValue,
                heirs: [],
                mahjub: mahjubHeirs.map(m => m.key) 
            };

            resultsDiv.innerHTML += `<h2 class="text-2xl font-bold my-6 text-teal-700">${langData.res_title}</h2>`;
            let hasAnyHeir = false;

            for (const k in heirs) {
                if (heirs[k] && heirs[k].share > EPSILON) {
                    hasAnyHeir = true;
                    const info = heirs[k];
                    info.amount = info.share * (estateValue > 0 ? estateValue : 0); 

                    latestCalculationResult.heirs.push({
                        key: k,
                        sharePercent: (info.share * 100).toFixed(3),
                        amount: info.amount,
                        note: info.note
                    });

                    let label = "";
                    if(k === 'husband') label = langData.h_spouse;
                    else if(k === 'wives') label = langData.lbl_wives;
                    else if(k === 'sons') label = langData.lbl_sons;
                    else if(k === 'daughters') label = langData.lbl_daughters;
                    else if(k === 'father') label = langData.lbl_father;
                    else if(k === 'mother') label = langData.lbl_mother;
                    else if(k === 'sonSons') label = langData.lbl_ss;
                    else if(k === 'sonDaughters') label = langData.lbl_sd;
                    else if(k === 'fullBrothers') label = langData.lbl_fb;
                    else if(k === 'fullSisters') label = langData.lbl_fs;
                    else if(k === 'paternalBrothers') label = langData.lbl_pb;
                    else if(k === 'paternalSisters') label = langData.lbl_ps;
                    else if(k === 'uterineSiblings') label = langData.lbl_us;
                    else if(k.includes('Grandfather')) label = langData.lbl_pgf;
                    else if(k.includes('Grandmother')) label = langData.lbl_mgm;
                    else label = k; 

                    resultsDiv.innerHTML += `
                        <div class="neu-flat p-6 mb-4 result-card-neu">
                            <h4 class="text-lg font-bold text-teal-700">${label}</h4>
                            <p class="text-xs text-slate-500 italic mb-2">${info.note || ''}</p>
                            <div class="flex justify-between items-end">
                                <div>
                                    <p class="text-sm font-medium text-slate-500">${langData.share}</p>
                                    <p class="text-md font-bold text-slate-700">${(info.share * 100).toFixed(3)}%</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm font-medium text-slate-500">${langData.amount}</p>
                                    <p class="text-lg font-extrabold text-teal-600">Rp ${info.amount.toLocaleString('id-ID', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            
            if (!hasAnyHeir && (estateValue > EPSILON || totalHartaPeninggalan <=0) ) { 
                 resultsDiv.innerHTML += `<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md shadow-md" role="alert"><p class="font-bold">${langData.alert_no_heir}</p></div>`;
            }

            if (mahjubHeirs.length > 0) {
                let list = mahjubHeirs.map(h => `<li>${h.name}</li>`).join('');
                hijabDiv.innerHTML = `
                    <div class="neu-flat p-6 mt-6 hijab-card-neu">
                        <h4 class="text-lg font-bold text-amber-600 mb-2">${langData.mahjub_title}</h4>
                        <p class="text-sm text-amber-700/70 mb-3 italic">${langData.mahjub_desc}</p>
                        <ul class="list-disc list-inside text-slate-600 text-sm space-y-1 px-2">
                            ${list}
                        </ul>
                    </div>
                `;
            }
            pdfButtonContainer.style.display = 'block'; 
        });

        document.getElementById('resetButton').addEventListener('click', function() {
            document.querySelectorAll('input').forEach(input => {
                if(input.type === 'checkbox') input.checked = false;
                else if(input.type === 'number') input.value = '';
                else input.value = '';
            });
            document.getElementById('deceasedGender').value = 'male';
            document.getElementById('summary').innerHTML = '';
            document.getElementById('results').innerHTML = '';
            document.getElementById('hijabSection').innerHTML = '';
            document.getElementById('pdfButtonContainer').style.display = 'none';
            latestCalculationResult = null;
        });

        function generateAndSavePdf() {
            if (!latestCalculationResult) {
                alert("Silakan tekan tombol Hitung Warisan terlebih dahulu.");
                return;
            }

            const data = latestCalculationResult;
            const pdfDoc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
            
            pdfDoc.setFillColor(13, 148, 136);
            pdfDoc.rect(0, 0, 210, 30, 'F');
            pdfDoc.setTextColor(255, 255, 255);
            pdfDoc.setFontSize(18);
            pdfDoc.setFont(undefined, 'bold');
            pdfDoc.text("Laporan Waris Islami", 105, 18, { align: 'center' });
            pdfDoc.setFontSize(10);
            pdfDoc.setFont(undefined, 'normal');
            pdfDoc.text("Kalkulator Syariah Indonesia", 105, 25, { align: 'center' });
            
            pdfDoc.setTextColor(0, 0, 0);
            const dateStr = new Date().toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric'});
            pdfDoc.text(`Tanggal: ${dateStr}`, 190, 40, { align: 'right' });

            let y = 50; 
            const lm = 15;
            
            const addText = (txt, x, y, opts={}) => {
                pdfDoc.setFontSize(opts.size || 10);
                if(opts.bold) pdfDoc.setFont(undefined, 'bold'); else pdfDoc.setFont(undefined, 'normal');
                if(opts.italic) pdfDoc.setFont(undefined, 'italic');
                pdfDoc.setTextColor(opts.col ? opts.col[0] : 0, opts.col ? opts.col[1] : 0, opts.col ? opts.col[2] : 0);
                
                const lines = pdfDoc.splitTextToSize(String(txt), 180);
                if(y + lines.length*6 > 270) { 
                    pdfDoc.addPage(); y=20; 
                }
                pdfDoc.text(lines, x, y, { align: opts.align || 'left' });
                return y + lines.length*6;
            };

            y = addText(`Nama Almarhum/ah: ${data.deceasedName}`, lm, y, {bold:true, size:12, col:[13,148,136]});
            y += 4;

            pdfDoc.setFillColor(240, 253, 250);
            pdfDoc.rect(lm, y-5, 180, 8, 'F');
            y = addText("1. Ringkasan Harta & Kewajiban", lm+2, y, {bold:true});
            y += 2;
            
            const fmt = (n) => "Rp " + n.toLocaleString('id-ID');
            y = addText(`Total Harta: ${fmt(data.totalHarta)}`, lm, y);
            y = addText(`Hutang: - ${fmt(data.hutang)}`, lm, y);
            y = addText(`Biaya Jenazah: - ${fmt(data.biayaJenazah)}`, lm, y);
            y = addText(`Wasiat: - ${fmt(data.wasiat)}`, lm, y);
            y += 2;
            y = addText(`Harta Waris Bersih: ${fmt(data.netEstate)}`, lm, y, {bold:true, size:11});
            y += 6;

            pdfDoc.setFillColor(240, 253, 250);
            pdfDoc.rect(lm, y-5, 180, 8, 'F');
            y = addText("2. Hasil Pembagian Waris", lm+2, y, {bold:true});
            y += 4;

            if (data.heirs.length === 0) {
                 y = addText("Tidak ada ahli waris yang berhak atau harta habis.", lm, y, {italic:true});
            } else {
                data.heirs.forEach(h => {
                    const label = pdfLabels[h.key] || h.key;
                    
                    pdfDoc.setDrawColor(200);
                    pdfDoc.rect(lm, y-4, 180, 16); // Box
                    
                    let tempY = y;
                    addText(label, lm+2, tempY, {bold:true});
                    addText(`Bagian: ${h.sharePercent}% (${h.note})`, lm+2, tempY+5, {size:9, col:[80,80,80]});
                    addText(fmt(h.amount), 190, tempY+2, {bold:true, size:11, align:'right', col:[13,148,136]});
                    
                    y += 20; 
                    if(y > 270) { pdfDoc.addPage(); y=20; }
                });
            }

            if(data.mahjub && data.mahjub.length > 0) {
                y += 5;
                if(y > 260) { pdfDoc.addPage(); y=20; }
                pdfDoc.setFillColor(254, 243, 199);
                pdfDoc.rect(lm, y-5, 180, 8, 'F');
                y = addText("3. Ahli Waris Terhalang (Mahjub)", lm+2, y, {bold:true});
                y += 2;
                data.mahjub.forEach(key => {
                    const label = pdfLabels[key] || key;
                    y = addText(`- ${label}`, lm+5, y, {size:9});
                });
            }

            const ph = pdfDoc.internal.pageSize.getHeight();
            pdfDoc.setDrawColor(13, 148, 136);
            pdfDoc.line(lm, ph-25, 190, ph-25);
            pdfDoc.setFontSize(8);
            pdfDoc.text("Dibuat oleh : Ust Hendra & Tim Syariah Waris Indonesia", 105, ph-15, {align:'center'});
            pdfDoc.text("Disclaimer: Hasil ini adalah estimasi awal. Konsultasikan dengan ulama untuk fatwa final.", 105, ph-10, {align:'center'});

            pdfDoc.save('Laporan_Waris_Islami.pdf');
        }

        const paymentModal = document.getElementById('paymentModal');
        const savePdfButton = document.getElementById('savePdfButton');
        const confirmPaymentButton = document.getElementById('confirmPaymentButton');
        const closeModalButton = document.getElementById('closeModalButton');

        savePdfButton.addEventListener('click', () => {
            paymentModal.classList.remove('pointer-events-none', 'opacity-0');
            paymentModal.classList.add('pointer-events-auto', 'opacity-100', 'active');
        });

        confirmPaymentButton.addEventListener('click', () => {
            paymentModal.classList.remove('pointer-events-auto', 'opacity-100', 'active');
            paymentModal.classList.add('pointer-events-none', 'opacity-0');
            generateAndSavePdf();
        });

        closeModalButton.addEventListener('click', () => {
            paymentModal.classList.remove('pointer-events-auto', 'opacity-100', 'active');
            paymentModal.classList.add('pointer-events-none', 'opacity-0');
        });
        
    </script>
</body>
</html>
